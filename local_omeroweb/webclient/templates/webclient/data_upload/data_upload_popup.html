{% extends "webgateway/core_html.html" %}
{% load i18n %}

{% block title %}
    Upload Data
{% endblock %}

{% block link %}
    <style type="text/css">
        body {
            font-family: Arial;
            background: #eee;
            margin: 0px;
            padding: 0px;
        }
        div.footer {
            background: #ddd; 
            position:fixed; 
            bottom:0px; left:0px; right:0px;
            padding: 7px;
            border-top: 1px solid #aaa;
            font-size: 80%;
        }
        h3 {
            margin-top: 0px;
            padding-bottom: 10px;
            border-bottom: solid #aaa 1px;
        }
        input[type='text'] {
            border: solid 1px rgba(0,0,0,.2);
            border-top: solid 1px rgba(0,0,0,.3);
            box-shadow: 0 1px 0 white, inset 0 1px 1px rgba(0,0,0,.1);
            border-radius: 2px;
            padding: 5px;
        }
        #spinner {
            display: none;
            margin: -2px 0;
        }
        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #b0c4de; /* Blue gray */
        }
        th {
            background-color: #808080; /* Darker gray */
            padding: 10px;
            text-align: left;
        }
        td {
            padding: 10px;
            border-top: 1px solid #fff;
        }
    </style>
{% endblock %}

{% block script %}
    {{ block.super }}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        // Use jQuery's no-conflict mode
        var $j = jQuery.noConflict();
        $j(document).ready(function() {
            if ($j('#groupSelect option').length <= 1) {
                showError('Error: No groups were passed to the template.');
            }
            $j('#groupSelect').change(function() {
                var selectedGroup = $j(this).val();
                if (selectedGroup) {
                    $j('#projectSelect').show();  // Show the project dropdown when a group is selected
                } else {
                    $j('#projectSelect').hide();
                    $j('#datasetSelect').hide();
                }
            });

            $j('#data_files').change(function() {
                var files = this.files;
                $j('#fileList').empty(); // Clear the list

                // Add table header
                var tableHeader = '<table><thead><tr><th>File Name</th><th>Metadata File</th></tr></thead><tbody>';
                $j('#fileList').append(tableHeader);

                for (var i = 0; i < files.length; i++) {
                    var file = files[i];
                    var fileName = file.name;

                    var fileRow = '<tr><td>' + fileName + '</td><td><input type="file" name="metadata_file_' + i + '" /></td></tr>';
                    $j('#fileList tbody').append(fileRow);
                }

                $j('#fileList').append('</tbody></table>');
            });
        });
    </script>
{% endblock %}
{% block body %}
    <form id='data_upload_form' method="post" action="{% url 'data_upload' %}">{% csrf_token %}
        <div style="padding:10px; margin-bottom:40px">
            <h3 id="dataUploadName">Upload Data</h3>
            <div id="descriptionDiv">
                <p>description of Upload process and script info</p>
            </div>
            {% include "webclient/data_upload/user_auth_get.html" with authorizedGroups=authorizedGroups %}
            <script>console.log("Loading data_upload_popup template");</script>

            {% for group in authorizedGroups %}
                <script>console.log("Group: " + "{{ group.getName }}");</script>
            {% endfor %}
            <p>
                <label>Choose files to upload:</label>
                <input id="data_files" name="data_files" type="file" multiple />
            </p>
            
            <div id="fileList"></div>

            <p id="targetInfo" style="display:none">
                <span id="targetMessage"></span>
                <pre><code id="targetPath"></code></pre>
            </p>
        </div>
        <div class="footer">
            <div style="float:right">
                <a href="#" tabIndex="3" onClick="self.close()">Close</a>
                <input id="submit" tabIndex="2" type="submit" value="Upload Data" />
                <img id="spinner" src ="{% static "webgateway/img/spinner.gif" %}"/>
            </div>
        </div>
    </form>
{% endblock %}